<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Tracker</title>
  <meta name="description" content="Modern, mobile-friendly budget tracker with persistent totals and input validation.">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Base Styling */
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', Arial, sans-serif;
      background: #f4f8fc;
      color: #222;
      min-height: 100%;
    }
    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 18px 8px 40px 8px;
      background: #fff;
      min-height: 96vh;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(80,80,110,0.14);
    }
    header {
      text-align: center;
      margin-bottom: 10px;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 0;
      color: #364fc7;
    }
    .summary {
      background: #e9ecef;
      margin: 12px 0 16px 0;
      border-radius: 10px;
      padding: 16px 12px 10px 12px;
      box-shadow: 0 2px 10px rgba(80,80,100,0.04);
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 1.04em;
    }
    .balance {
      font-size: 1.22em;
      font-weight: bold;
      color: #228be6;
      letter-spacing: 0.5px;
    }
    .section {
      margin: 20px 0 12px 0;
      padding: 10px 0 2px 0;
      border-bottom: 1px solid #f2f3fb;
    }
    label {
      font-size: 1em;
      font-weight: 500;
      margin-bottom: 4px;
      display: block;
      color: #3b3b44;
    }
    input, select, button {
      font-family: inherit;
      font-size: 1em;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #dee2e6;
      outline: none;
      transition: box-shadow 0.2s;
    }
    input:focus, select:focus {
      border-color: #364fc7;
      box-shadow: 0 0 3px #364fc7;
    }
    input[type='number']::-webkit-inner-spin-button,
    input[type='number']::-webkit-outer-spin-button {
      -webkit-appearance: none; margin: 0;
    }
    form {
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 1px;
    }
    .form-row {
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
    }
    .category-select {
      width: 100%;
    }
    .input-error {
      color: #f03e3e;
      font-size: 0.98em;
      margin-bottom: 8px;
      min-height: 14px;
      transition: opacity 0.2s;
    }
    button {
      background: #228be6;
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: bold;
      margin-bottom: 4px;
      transition: background 0.18s;
    }
    button:active, button:focus {
      background: #1b6dc9;
    }
    .table-container table {
      width: 100%;
      border-collapse: collapse;
      margin: 6px 0 0 0;
      font-size: 0.97em;
      background: #f7faff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 4px rgba(120,140,200,0.04);
    }
    .table-container th, .table-container td {
      text-align: left;
      padding: 7px 4px 7px 8px;
      border-bottom: 1px solid #e3e7f0;
    }
    .table-container th {
      background: #d0ebff;
      font-weight: 600;
      color: #364fc7;
    }
    .table-container tr:last-child td {
      border-bottom: none;
    }
    .add-row {
      border-left: 4px solid #51cf66;
    }
    .del-row {
      border-left: 4px solid #fa5252;
    }
    .transaction-type {
      font-size: 1.2em;
      text-align: center;
      color: #868e96;
      background: transparent;
    }
    .delete-btn {
      background: #fa5252;
      color: #fff;
      border: none;
      font-weight: bold;
      border-radius: 3px;
      padding: 3px 6px;
      cursor: pointer;
      font-size: 0.9em;
    }
    .delete-btn:active {
      background: #c92a2a;
    }
    .clear-button-group {
      display: flex;
      justify-content: flex-end;
      margin-top: 12px;
    }
    .notification {
      display: none;
      color: #495057;
      margin: 10px 0;
      padding: 7px;
      background: #fff3bf;
      border: 1px solid #ffe066;
      border-radius: 5px;
      font-size: 1.02em;
    }
    .notification.visible {
      display: block;
      animation: fadeInOut 2.3s linear;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; }
      10% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; }
    }

    @media (max-width: 750px) {
      .container {
        max-width: 100vw;
        border-radius: 0;
        min-height: 96vh;
      }
      body {
        padding: 0;
        margin: 0;
      }
      .summary {
        padding: 12px 4px;
      }
      .table-container table, .table-container th, .table-container td {
        font-size: 0.95em;
      }
    }
    @media (max-width: 430px) {
      .container { padding: 5px 0; }
      h1 { font-size: 1.64em; }
      .summary { font-size: 0.97em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Budget Tracker</h1>
    </header>

    <section class="summary">
      <div class="summary-row">
        <span><strong>Total Income</strong>:</span>
        <span>₦<span id="total-income">0</span></span>
      </div>
      <div class="summary-row">
        <span><strong>Total Expenses</strong>:</span>
        <span>₦<span id="total-expenses">0</span></span>
      </div>
      <div class="summary-row balance">
        <span>Balance:</span>
        <span>₦<span id="balance">0</span></span>
      </div>
    </section>

    <section class="section">
      <h3>Add Income</h3>
      <form id="income-form" autocomplete="off" novalidate>
        <div class="form-row">
          <label for="income-desc">Description</label>
          <input type="text" id="income-desc" required maxlength="50" placeholder="e.g. Salary, Side Job" autocomplete="off">
        </div>
        <div class="form-row">
          <label for="income-amount">Amount (₦)</label>
          <input type="number" id="income-amount" min="0.01" step="0.01" required placeholder="e.g. 20000">
        </div>
        <div class="input-error" id="income-error"></div>
        <button type="submit">Add Income</button>
      </form>
    </section>

    <section class="section">
      <h3>Add Expense</h3>
      <form id="expense-form" autocomplete="off" novalidate>
        <div class="form-row">
          <label for="expense-desc">Description</label>
          <input type="text" id="expense-desc" required maxlength="50" placeholder="e.g. Groceries, Rent" autocomplete="off">
        </div>
        <div class="form-row">
          <label for="expense-category">Category</label>
          <select id="expense-category" required>
            <option value="">Choose Category</option>
            <option>Housing</option>
            <option>Food</option>
            <option>Transportation</option>
            <option>Entertainment</option>
            <option>Healthcare</option>
            <option>Utilities</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-row">
          <label for="expense-amount">Amount (₦)</label>
          <input type="number" id="expense-amount" min="0.01" step="0.01" required placeholder="e.g. 1200">
        </div>
        <div class="input-error" id="expense-error"></div>
        <button type="submit">Add Expense</button>
      </form>
    </section>

    <div class="table-container">
      <h3>Transactions</h3>
      <table>
        <thead>
          <tr>
            <th>Description</th>
            <th>Category</th>
            <th>Amount (₦)</th>
            <th>Type</th>
            <th>Date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="transactions"></tbody>
      </table>
    </div>

    <div class="clear-button-group">
      <button id="clear-all-btn" style="background:#f59f00;color:#212529;border:none;">Clear All Data</button>
    </div>
    <div class="notification" id="notification"></div>
  </div>

  <script>
    // ---- Constants and Initial Data Loading ----
    const incomeForm = document.getElementById('income-form');
    const expenseForm = document.getElementById('expense-form');
    const incomeError = document.getElementById('income-error');
    const expenseError = document.getElementById('expense-error');
    const transactionsTbody = document.getElementById('transactions');
    const totalIncomeSpan = document.getElementById('total-income');
    const totalExpensesSpan = document.getElementById('total-expenses');
    const balanceSpan = document.getElementById('balance');
    const clearAllBtn = document.getElementById('clear-all-btn');
    const notification = document.getElementById('notification');

    // Fallback if localStorage is not available
    function safeGetItem(key, fallback) {
      try { return JSON.parse(localStorage.getItem(key)) ?? fallback; } catch { return fallback; }
    }
    function safeSetItem(key, value) {
      try { localStorage.setItem(key, JSON.stringify(value)); } catch { /* ignore */ }
    }

    let transactions = safeGetItem('budget_transactions', []);
    let totals = safeGetItem('budget_totals', {income: 0, expenses: 0});

    function uuid() {
      return Date.now().toString() + '_' + Math.floor(Math.random() * 100000);
    }

    // ---- Data Update and UI Rendering Functions ----

    function addTransaction(type, desc, category, amount) {
      const date = new Date();
      const dateStr = date.toLocaleDateString('en-GB') + ' ' + date.toLocaleTimeString('en-GB', { hour:'2-digit', minute:'2-digit' });
      const tx = { id: uuid(), type, desc, category, amount: Number(amount), date: dateStr };
      transactions.push(tx);
      if(type === 'Income') { totals.income += Number(amount); }
      else { totals.expenses += Number(amount); }
      persistData();
      renderTransactions();
      updateTotals();
      showNotification(`${type} added.`);
    }

    function removeTransaction(id) {
      const idx = transactions.findIndex(t => t.id === id);
      if(idx > -1) {
        const tx = transactions[idx];
        if(tx.type === 'Income') totals.income -= tx.amount;
        else totals.expenses -= tx.amount;
        transactions.splice(idx, 1);
        persistData();
        renderTransactions();
        updateTotals();
        showNotification(`${tx.type} deleted.`);
      }
    }

    function persistData() {
      safeSetItem('budget_transactions', transactions);
      safeSetItem('budget_totals', totals);
    }

    function updateTotals() {
      totals.income = 0; totals.expenses = 0;
      for(const tx of transactions) {
        if(tx.type === 'Income') totals.income += tx.amount;
        else totals.expenses += tx.amount;
      }
      totalIncomeSpan.textContent = totals.income.toFixed(2);
      totalExpensesSpan.textContent = totals.expenses.toFixed(2);
      const bal = totals.income - totals.expenses;
      balanceSpan.textContent = bal.toFixed(2);
      balanceSpan.style.color = (bal >= 0) ? '#228be6' : '#fa5252';
    }

    function renderTransactions() {
      transactionsTbody.innerHTML = '';
      for(const tx of transactions.slice().reverse()) {
        const row = document.createElement('tr');
        row.className = (tx.type === 'Income') ? 'add-row' : 'del-row';
        row.innerHTML = `
          <td>${tx.desc}</td>
          <td>${tx.category || '-'}</td>
          <td>${tx.amount.toFixed(2)}</td>
          <td class="transaction-type">${tx.type === 'Income' ? '⬆️' : '⬇️'}</td>
          <td>${tx.date}</td>
          <td><button class="delete-btn" data-id="${tx.id}" title="Delete">Delete</button></td>
        `;
        transactionsTbody.appendChild(row);
      }
    }

    function showNotification(msg) {
      notification.textContent = msg;
      notification.className = 'notification visible';
      setTimeout(() => { notification.className = 'notification'; }, 2000);
    }

    // ---- Inline Validation Helpers ----

    function validateInput(desc, amount) {
      let err = '';
      if(!desc || !desc.trim()) err = 'Description is required.';
      else if(desc.length > 50) err = 'Description is too long.';
      else if(!amount || isNaN(amount) || Number(amount) <= 0) err = 'Amount must be positive.';
      return err;
    }

    // ---- Event Handlers ----

    incomeForm.addEventListener('submit', function(e) {
      e.preventDefault();
      incomeError.textContent = '';
      const desc = document.getElementById('income-desc').value.trim();
      const amount = document.getElementById('income-amount').value.trim();
      const err = validateInput(desc, amount);
      if(err) {
        incomeError.textContent = err;
        return;
      }
      addTransaction('Income', desc, '-', amount);
      incomeForm.reset();
    });

    expenseForm.addEventListener('submit', function(e) {
      e.preventDefault();
      expenseError.textContent = '';
      const desc = document.getElementById('expense-desc').value.trim();
      const category = document.getElementById('expense-category').value.trim();
      const amount = document.getElementById('expense-amount').value.trim();
      let err = validateInput(desc, amount);
      if(!err && !category) err = 'Category is required.';
      if(err) {
        expenseError.textContent = err;
        return;
      }
      addTransaction('Expense', desc, category, amount);
      expenseForm.reset();
    });

    transactionsTbody.addEventListener('click', function(e) {
      if(e.target.classList.contains('delete-btn')) {
        const id = e.target.getAttribute('data-id');
        removeTransaction(id);
      }
    });

    clearAllBtn.addEventListener('click', function() {
      if(confirm('Clear all data?')) {
        transactions = [];
        totals = {income: 0, expenses: 0};
        persistData();
        renderTransactions();
        updateTotals();
        showNotification('All data cleared.');
      }
    });

    // ---- Initialization ----

    function init() {
      renderTransactions();
      updateTotals();
      incomeForm.reset();
      expenseForm.reset();
    }
    init();
  </script>
</body>
</html>
